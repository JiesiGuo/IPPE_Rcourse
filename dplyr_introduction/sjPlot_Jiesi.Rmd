---
title: "SJPOLT-PACKAGE INTRODUCTION"
output: html_document
---

## Description 
Providing plotting and table output functions for data visualization. Results of a variety of statical analyses can be visualized using this package (particularly for people coming from SPSS and/or who are new to R). 

## stPlot functionality
*Reading and writing data from (SPSS, SAS and STATA) with variable and value labels (e.g., `read_spss`, `write_spss`)
*Providing SPSS-like output for simple description (`sjt.df`), cross tabulated (`sjp.xtab`,`sjt.xtab`), frequencies (`sjp.frq`, `sjt.frq`), histograms, box plots, correlation matrices (`sjt.corr`), PCA (`sjp.pca`, `sjt.pca`), etc.
*Ploting and summarising the outputs for linear regression model with interaction (`sjp.lm`,  `sjp.int`, `sjt.lm`), generalized linear regression models (`sjp.glm`) and multilevel reggression model (`sjp.lmer`, `sjt.glmer`), etc. 

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                     warning=FALSE, message=FALSE)
```

```{r package_options, include=FALSE}
knitr::opts_knit$set(progress = TRUE, verbose = TRUE)
```

##Installation

```{r,load_packages}
# load packages
library(sjPlot)
library(sjmisc)
```

```{r, results='hide'}
pisa<-read_spss("PISA12_AUS_motivation.sav", 
                enc="UTF-8",                # character encoding
                autoAttachVarLabels = TRUE) # attach variable labels
```
There are `r nrow(pisa)` individuals.
* overview your data using `view_spss` and `sjt.df`
```{r,eval=FALSE}
view_spss(pisa[,1:8],
          #  showFreq = TRUE, 
          #  showPerc = TRUE
)
```
`r view_spss(pisa[,1:8], no.output = TRUE)$knitr`

```{r, eval=FALSE}
# display data description like 'describe' function in 'psych' package
sjt.df(pisa[,10:15])
```
`r sjt.df(pisa[,10:15],no.output=TRUE)$knitr`

*`sjt.lm`for printing summaries of linear models
```{r}
# model1: math behavior is predicted by math self-concept, interest value, intrinsic value and gender
model1 <- lm(MATBEH ~ SCMAT + INTMAT + INSTMOT + Gender, data=pisa)
# model2: math workethic is predicted by math self-concept, interest value, intrinsic value and gender
model2 <- lm(MATWKETH ~ SCMAT + INTMAT + INSTMOT + Gender, data=pisa)
```

```{r, eval=FALSE}
sjt.lm(model1, model2)
```
`r sjt.lm(fit1, fit2, no.output = TRUE)$knitr`

```{r}
# add custom labels and convert to APA output
sjt.lm(model1, model2,
       showHeaderStrings = TRUE,
       stringB = "Estimate",
       showStdBeta = TRUE,
#       stringCI = "Conf. Int.",
       pvaluesAsNumbers = FALSE,
       showStdError = TRUE,
       showConfInt = FALSE,
       stringDependentVariables = "Outcomes",
       stringPredictors = "Predictors",
       labelDependentVariables = c("Math behaviors", 
                                  "Math work ethic")
#      CSS = list(css.topcontentborder = "+font-size: 0px;")  # remove intercept
#      remove.estimates = 2  # remove the second coefficient after intercept
       )       
```
`r sjt.lm(fit1, fit2,
       showHeaderStrings = TRUE,
       stringB = "Estimate",
       showStdBeta = TRUE,
       pvaluesAsNumbers = FALSE,
       showStdError = TRUE,
       showConfInt = FALSE,
       stringDependentVariables = "Outcomes",
       stringPredictors = "Predictors",
       labelDependentVariables = c("Math behaviors", 
                                  "Math work ethic"))$knitr`
                                  
* another package [texteg](http://cran.r-project.org/web/packages/texreg/texreg.pdf) - extract output from a vast majority of models                                  
```{r eval=FALSE}
# extract similar output using `texreg`
install.packages("texreg")
library(texreg)
screenreg(list(
  extract(fit, summaries = c("Observations", "CFI", "SRMR")),
  extract(fit2, summaries = c("Observations", "CFI", "SRMR"))),
  single.row=TRUE)
```

* `sjp.lm for ploting coefficients of linear model
```{r}p

# testing model assumption including (tests for outliers, multicollinearity, non-normality of residual and outliers, non-normlity of residual, homoscedasticity)
sjp.lm(fit1, type = "ma",
       showOriginalModelOnly = TRUE) # FLASE: the following graphical tests will be both applied to the original and to the updated model
```

```{r eval=FALSE}
# plot the standardized beta coefficients
sjp.lm(fit1, type = "std")           
# investigate each single predictor of the model
sjp.lm(fit1, type = "pred")          
```
* plotting interaction using `sjp.int`, which accepts _lm_, _glm_ and _lme4_.[see more examples](http://www.strengejacke.de/sjPlot/sjp.int/)
```{r}
# Plotting interaction for a binary moderator
fit3 <- lm(MATWKETH ~ Gender*SCMAT, data=pisa, 
           x =TRUE) # it doesn't work for Gender:SCMAT)
sjt.lm(fit3)
sjp.int(fit3, type = "eff")
     #   showValueLabels = TRUE) # show value labels of the predicted values
#Plotting interaction for a continuous moderator
install.packages("effects")
library(effects)
pisa$Gender < pisa$Gender - 1
fit4 <- lm(scale(MATWKETH) ~ scale(SCMAT)*scale(INSTMOT), data=pisa, x = TRUE)
fit4 <- lm(MATWKETH ~ SCMAT*INSTMOT, data=pisa, x = TRUE)

summary(fit4)
sjt.lm(fit4) 
sjp.int(fit4,type = "eff", moderatorValues = "meansd") 
